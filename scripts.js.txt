const btn = document.getElementById("generateBtn");
const loading = document.getElementById("loading");
const result = document.getElementById("result");
const API_KEY = "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";

btn.addEventListener("click", generatePlan);

async function generatePlan() {

  const ingredients = document.getElementById("ingredients").value;
  const diet = document.getElementById("diet").value;
  const budget = document.getElementById("budget").value;
  const time = document.getElementById("time").value;

  if (!ingredients.trim()) {
    alert("Please enter ingredients.");
    return;
  }

  loading.classList.remove("hidden");
  result.innerText = "";

  const prompt = `
You are a professional chef and nutritionist.

Create a 7-day meal plan using:
${ingredients}

Diet: ${diet}
Budget: ${budget}
Cooking time: ${time}

Include:
- Breakfast, lunch, dinner
- Simple recipes
- Calories
- Shopping list
`;

  try {

    const response = await fetch("https://api.openai.com/v1/chat/completions", {

      method: "POST",

      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + API_KEY
      },

      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: [
          { role: "user", content: prompt }
        ],
        temperature: 0.7
      })

    });

    const data = await response.json();

    const text = data.choices[0].message.content;

    result.innerText = text;

  }

  catch (error) {
    result.innerText = "Something went wrong. Try again later.";
    console.error(error);
  }

  loading.classList.add("hidden");
}